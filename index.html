<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>WebXR 2D Stream Test</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
    }
    video {
      max-width: 100vw;
      max-height: 100vh;
      background: #000;
      outline: none;
    }
    /* Always-on-top Start button so Oculus taps don't get eaten by the video */
    #start {
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      z-index: 99999;
      background: #1e90ff;
      color: #fff;
      border: 0;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    }
  </style>
</head>
<body>

  <video id="video" playsinline webkit-playsinline></video>
  <button id="start" type="button">Tap to start</button>

  <!-- hls.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const video = document.getElementById('video');
    const btn   = document.getElementById('start');

    // >>> Replace this with your HLS .m3u8 URL
    const STREAM_URL = 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8';
    // <<<

    function loadAndPlay() {
      btn.style.display = 'none';

      // Remove controls until playback starts (controls overlays can block clicks in VR)
      video.removeAttribute('controls');

      if (window.Hls && Hls.isSupported()) {
        const hls = new Hls({ lowLatencyMode: true });
        hls.loadSource(STREAM_URL);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play().catch(err => {
            console.warn('Autoplay blocked, showing button again:', err);
            btn.style.display = 'block';
          });
        });

        hls.on(Hls.Events.ERROR, (event, data) => {
          console.error('HLS error:', data);
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        // Safari path
        video.src = STREAM_URL;
        video.play().catch(err => {
          console.warn('Autoplay blocked (Safari):', err);
          btn.style.display = 'block';
        });
      } else {
        alert('This browser does not support HLS playback.');
        btn.style.display = 'block';
        return;
      }

      // Add controls after playback begins
      video.addEventListener('playing', () => {
        video.setAttribute('controls', '');
      }, { once: true });
    }

    // Pointer is more reliable in Oculus; keep click as fallback
    btn.addEventListener('pointerdown', loadAndPlay, { passive: true });
    btn.addEventListener('click', loadAndPlay, { passive: true });

    // Resume if page regains focus
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden && video.paused && btn.style.display === 'none') {
        video.play().catch(()=>{});
      }
    });
  </script>
</body>
</html>